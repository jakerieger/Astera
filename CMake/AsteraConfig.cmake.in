@PACKAGE_INIT@

# Astera CMake Configuration File
# This file is used by find_package(Astera) to import targets

include(CMakeFindDependencyMacro)

# Find required dependencies
find_dependency(fmt REQUIRED)
find_dependency(pugixml REQUIRED)
find_dependency(spdlog REQUIRED)
find_dependency(CLI11 REQUIRED)
find_dependency(PkgConfig REQUIRED)

pkg_check_modules(LUAJIT REQUIRED luajit)
pkg_check_modules(GLFW REQUIRED glfw3)

# Define the EngineContent path for users of the package
set(ASTERA_CONTENT_DIR "${PACKAGE_PREFIX_DIR}/@CMAKE_INSTALL_DATADIR@/Astera/EngineContent")
set(ASTERA_INCLUDE_DIR "${PACKAGE_PREFIX_DIR}/@CMAKE_INSTALL_INCLUDEDIR@/Astera")

# Export LuaJIT and GLFW variables for consumers
set(ASTERA_LUAJIT_INCLUDE_DIRS ${LUAJIT_INCLUDE_DIRS})
set(ASTERA_LUAJIT_LIBRARIES ${LUAJIT_LIBRARIES})
set(ASTERA_LUAJIT_LIBRARY_DIRS ${LUAJIT_LIBRARY_DIRS})
set(ASTERA_GLFW_INCLUDE_DIRS ${GLFW_INCLUDE_DIRS})
set(ASTERA_GLFW_LIBRARIES ${GLFW_LIBRARIES})

# Include the exported targets
if(NOT TARGET Astera_Shared)
    include("${CMAKE_CURRENT_LIST_DIR}/AsteraTargets.cmake")
endif()

# Set proper include directories on the imported targets
# This is critical for external projects to find headers
if(TARGET Astera_Shared)
    set_property(TARGET Astera_Shared APPEND PROPERTY
        INTERFACE_INCLUDE_DIRECTORIES
        "${ASTERA_INCLUDE_DIR}"
        "${ASTERA_INCLUDE_DIR}/Common"
        "${ASTERA_INCLUDE_DIR}/Vendor"
        "${LUAJIT_INCLUDE_DIRS}"
        "${GLFW_INCLUDE_DIRS}"
    )

    # Export the engine content path as a compile definition
    # This allows external projects to use ASTERA_ENGINE_CONTENT_DIR in their code
    set_property(TARGET Astera_Shared APPEND PROPERTY
        INTERFACE_COMPILE_DEFINITIONS
        "ASTERA_ENGINE_CONTENT_DIR=\"${ASTERA_CONTENT_DIR}\""
    )
endif()

if(TARGET Astera_Static)
    set_property(TARGET Astera_Static APPEND PROPERTY
        INTERFACE_INCLUDE_DIRECTORIES
        "${ASTERA_INCLUDE_DIR}"
        "${ASTERA_INCLUDE_DIR}/Common"
        "${ASTERA_INCLUDE_DIR}/Vendor"
        "${LUAJIT_INCLUDE_DIRS}"
        "${GLFW_INCLUDE_DIRS}"
    )

    # Export the engine content path as a compile definition
    # This allows external projects to use ASTERA_ENGINE_CONTENT_DIR in their code
    set_property(TARGET Astera_Static APPEND PROPERTY
        INTERFACE_COMPILE_DEFINITIONS
        "ASTERA_ENGINE_CONTENT_DIR=\"${ASTERA_CONTENT_DIR}\""
    )
endif()

# Create namespace aliases that work correctly
# These allow users to link with Astera::Shared instead of Astera::Astera_Shared
if(TARGET Astera_Shared AND NOT TARGET Astera::Shared)
    add_library(Astera::Shared ALIAS Astera_Shared)
endif()

if(TARGET Astera_Static AND NOT TARGET Astera::Static)
    add_library(Astera::Static ALIAS Astera_Static)
endif()

# Also create the default Astera::Astera alias pointing to shared
if(TARGET Astera_Shared AND NOT TARGET Astera::Astera)
    add_library(Astera::Astera ALIAS Astera_Shared)
endif()

# Provide information about available components
set(Astera_FOUND TRUE)
set(Astera_VERSION @PROJECT_VERSION@)

# Check which components are available
check_required_components(Astera)

# Print usage information
if(NOT Astera_FIND_QUIETLY)
    message(STATUS "Found Astera: ${Astera_VERSION}")
    message(STATUS "  Include directory: ${ASTERA_INCLUDE_DIR}")
    message(STATUS "  Engine content: ${ASTERA_CONTENT_DIR}")
    message(STATUS "  Available targets:")
    message(STATUS "    - Astera::Shared    (shared library)")
    message(STATUS "    - Astera::Static    (static library)")
    message(STATUS "    - Astera::Astera (shared library)")
endif()